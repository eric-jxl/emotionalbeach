<!DOCTYPE html>
<html lang="zh-CN" data-theme="auto">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>首页</title>
    <script src="/assets/tailwindcss.js" async></script>
    <!--    <script src="/assets/cdnFallback.js"></script>-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <style>
        html {
            background: linear-gradient(135deg, #5b6cff, #9333ea);
        }

        @media (prefers-color-scheme: dark) {
            html[data-theme='auto'] body {
                background-color: #1f2937;
                color: #f3f4f6;
            }
        }

        /* 验证码输入框 */
        .verification-box {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            margin-top: 8px;
            border-radius: 99px; /* 可选：添加圆角 */
        }

        .verification-box input {
            border: 1px solid black; /* 添加黑色边框 */
            padding: 8px; /* 可选：添加内边距 */
            border-radius: 10px; /* 可选：添加圆角 */
        }

        .verification-input {
            width: 48px;
            height: 48px;
            text-align: center;
            font-size: 1.2rem;
            border: none;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .verification-input:focus {
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* 提示信息 */
        .message {
            margin-top: 1rem;
            padding: 12px;
            border-radius: 6px;
            animation: fadeIn 0.3s ease;
        }

        .success {
            background: #f6ffed;
            color: #52c41a;
            border-left: 4px solid #52c41a;
        }

        .error {
            background: #fff1f0;
            color: #cf1322;
            border-left: 4px solid #cf1322;
        }

        @keyframes gradientAnimation {
            0% {
                background-position: 0 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0 50%;
            }
        }

        body.light-mode {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #957FEC, #398FFB, #60A033, #4CD1C6);
            background-size: 200% 200%;
            animation: gradientAnimation 10s ease infinite;
            color: #000;
        }

        .github-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 32px;
            color: #333;
            transition: color 0.2s ease;
        }

        .github-btn:hover {
            color: #000;
        }
    </style>
</head>
<!--<script>-->
<!--    loadCDN.setConfig({-->
<!--        timeout: 5000,-->
<!--        cssFallbackDir: "/assets/font-awesome-7.0.0.min.css",-->
<!--        jsFallbackDir: "/assets/tailwindcss.js"-->
<!--    })-->
<!--    loadCDN.loadJS('//cdn.iocdn.cc/npm/@tailwindcss/browser@4', '/assets/tailwindcss.js')-->
<!--        .then(() => {-->
<!--            console.log('JS文件加载成功');-->
<!--        })-->
<!--        .catch((err) => {-->
<!--            console.error('JS加载失败', err);-->
<!--        });-->
<!--</script>-->

<body class="flex items-center justify-center min-h-screen px-4 light-mode">

<div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md p-6 transition-all duration-300">
    <!-- 登录方式切换 -->
    <div class="flex justify-around mb-6 border-b border-gray-300 dark:border-gray-700">
        <button class="tab-btn font-bold text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400 pb-2"
                data-tab="pwd">密码登录
        </button>
        <button class="tab-btn text-gray-600 dark:text-gray-300 hover:text-blue-500 pb-2" data-tab="code">验证码登录
        </button>
        <button class="tab-btn text-gray-600 dark:text-gray-300 hover:text-blue-500 pb-2" data-tab="qrcode">扫码登录
        </button>
    </div>

    <!-- 密码登录面板 -->
    <div id="pwd" class="tab-panel space-y-4">
        <input type="text" placeholder="手机号/邮箱" id="username" required
               class="w-full border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
        <div class="relative">
            <input type="password" placeholder="密码" id="password" required
                   class="w-full border rounded px-4 py-2 pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
            <span class="absolute right-3 top-2.5 cursor-pointer" onclick="change_pwd_show()">👁️</span>
        </div>

        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded" onclick="handleLogin(event)"
                id="btn-login">
            登录
        </button>
    </div>

    <!-- 验证码登录面板 -->
    <div id="code" class="tab-panel hidden space-y-4">
        <input type="text" placeholder="手机号"
               class="w-full border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
        <div class="flex gap-2">
            <input type="text" placeholder="验证码"
                   class="flex-1 border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
            <button class="bg-blue-500 text-white px-4 py-2 rounded">获取</button>
        </div>
        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">登录</button>
    </div>

    <!-- 扫码登录面板 -->
    <div id="qrcode" class="tab-panel hidden text-center">
    </div>

    <div id="messageBox" class="message" style="display: none;"></div>

    <!-- 底部链接 -->
    <div class="flex justify-between mt-6 text-sm text-blue-500 dark:text-blue-400">
        <a href="#">注册账号</a>
        <!-- GitHub 登录按钮 -->
        <button id="github-login" class="github-btn">
            <i class="fa-brands fa-github"></i>
        </button>
        <a href="#">忘记密码</a>
    </div>

    <div class="text-center mt-4 text-xs text-gray-500 dark:text-gray-400">
        <a href="#">服务协议</a> ｜ <a href="#">隐私政策</a>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.tab-panel');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // 清除所有按钮的状态
                tabBtns.forEach(b => b.classList.remove('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400'));

                // 为当前点击的按钮添加状态
                btn.classList.add('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');

                // 隐藏所有面板
                panels.forEach(panel => {
                    panel.classList.add('hidden');
                });

                // 显示当前点击按钮对应的面板
                const targetPanelId = btn.dataset.tab;
                const targetPanel = document.getElementById(targetPanelId);
                if (targetPanel) {
                    targetPanel.classList.remove('hidden');
                }
            });
        });

        // 初始化时显示第一个面板
        if (panels.length > 0) {
            panels[0].classList.remove('hidden');
            tabBtns[0].classList.add('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');
        }
    });

    // 动态验证码输入处理
    const inputs = document.querySelectorAll('.verification-input');
    const messageBox = document.getElementById('messageBox');

    function showMessage(message, type) {
        const msgBox = messageBox;
        let timer;
        msgBox.className = 'message';

        if (type === 'success') {
            msgBox.classList.add('success')
        } else if (type === 'error') {
            msgBox.classList.add("error");
        } else {
            msgBox.classList.add("info");
        }

        msgBox.textContent = message;
        msgBox.style.display = 'block';

        clearTimeout(timer);
        timer = setTimeout(() => {
            msgBox.style.display = 'none';
        }, 3000);
    }

    // 登录表单处理
    function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!username || !password) {
            showMessage('请输入账号和密码', 'error');
            return;
        }

        // const code = Array.from(inputs).map(input => input.value).join('');
        // if (!/^\d{6}$/.test(code)) {
        //     showMessage('请输入6位动态验证码', 'error');
        //     return;
        // }
        //fixme: 请求认证接口
        const loginData = {
            username: username,
            password: password,
        }
        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(loginData),
        }).then(response => {
            if (!response.ok) {
                throw new Error(`登录失败: ${response.status}`);
            }
            return response.json();
        }).then(data => {
            if (data.code !== 200) {
                throw new Error(`${data.message || '未知错误'}`);
            }
            showMessage('登录成功，即将跳转...', 'success');
            setTimeout(() => {
                window.location.href = '/swagger/index.html'; // 替换为实际首页路径
            }, 1000);
        }).catch(error => {
            showMessage('登录失败：' + error.message, 'error');
        });
    }

    function change_pwd_show() {
        document.getElementById('password').type = 'text';
    }

    document.getElementById("pwd").addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
            document.querySelector('#btn-login').click();
        }
    });

    document.getElementById("github-login").addEventListener("click", () => {
        location.href = "/login/github";
    });

</script>
</body>
</html>