<!DOCTYPE html>
<html lang="zh-CN" data-theme="auto">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>é¦–é¡µ</title>
    <script src="/assets/tailwindcss.js" async></script>
    <!--    <script src="/assets/cdnFallback.js"></script>-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/7.0.0/css/all.min.css">
    <style>
        html {
            background: linear-gradient(135deg, #5b6cff, #9333ea);
        }

        @media (prefers-color-scheme: dark) {
            html[data-theme='auto'] body {
                background-color: #1f2937;
                color: #f3f4f6;
            }
        }

        /* éªŒè¯ç è¾“å…¥æ¡† */
        .verification-box {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            margin-top: 8px;
            border-radius: 99px; /* å¯é€‰ï¼šæ·»åŠ åœ†è§’ */
        }

        .verification-box input {
            border: 1px solid black; /* æ·»åŠ é»‘è‰²è¾¹æ¡† */
            padding: 8px; /* å¯é€‰ï¼šæ·»åŠ å†…è¾¹è· */
            border-radius: 10px; /* å¯é€‰ï¼šæ·»åŠ åœ†è§’ */
        }

        .verification-input {
            width: 48px;
            height: 48px;
            text-align: center;
            font-size: 1.2rem;
            border: none;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .verification-input:focus {
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        /* æç¤ºä¿¡æ¯ */
        .message {
            margin-top: 1rem;
            padding: 12px;
            border-radius: 6px;
            animation: fadeIn 0.3s ease;
        }

        .success {
            background: #f6ffed;
            color: #52c41a;
            border-left: 4px solid #52c41a;
        }

        .error {
            background: #fff1f0;
            color: #cf1322;
            border-left: 4px solid #cf1322;
        }

        @keyframes gradientAnimation {
            0% {
                background-position: 0 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0 50%;
            }
        }

        body.light-mode {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #957FEC, #398FFB, #60A033, #4CD1C6);
            background-size: 200% 200%;
            animation: gradientAnimation 10s ease infinite;
            color: #000;
        }

        .github-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 32px;
            color: #333;
            transition: color 0.2s ease;
        }

        .github-btn:hover {
            color: #000;
        }
    </style>
</head>
<!--<script>-->
<!--    loadCDN.setConfig({-->
<!--        timeout: 5000,-->
<!--        cssFallbackDir: "/assets/font-awesome-7.0.0.min.css",-->
<!--        jsFallbackDir: "/assets/tailwindcss.js"-->
<!--    })-->
<!--    loadCDN.loadJS('//cdn.iocdn.cc/npm/@tailwindcss/browser@4', '/assets/tailwindcss.js')-->
<!--        .then(() => {-->
<!--            console.log('JSæ–‡ä»¶åŠ è½½æˆåŠŸ');-->
<!--        })-->
<!--        .catch((err) => {-->
<!--            console.error('JSåŠ è½½å¤±è´¥', err);-->
<!--        });-->
<!--</script>-->

<body class="flex items-center justify-center min-h-screen px-4 light-mode">

<div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md p-6 transition-all duration-300">
    <!-- ç™»å½•æ–¹å¼åˆ‡æ¢ -->
    <div class="flex justify-around mb-6 border-b border-gray-300 dark:border-gray-700">
        <button class="tab-btn font-bold text-blue-600 dark:text-blue-400 border-b-2 border-blue-600 dark:border-blue-400 pb-2"
                data-tab="pwd">å¯†ç ç™»å½•
        </button>
        <button class="tab-btn text-gray-600 dark:text-gray-300 hover:text-blue-500 pb-2" data-tab="code">éªŒè¯ç ç™»å½•
        </button>
        <button class="tab-btn text-gray-600 dark:text-gray-300 hover:text-blue-500 pb-2" data-tab="qrcode">æ‰«ç ç™»å½•
        </button>
    </div>

    <!-- å¯†ç ç™»å½•é¢æ¿ -->
    <div id="pwd" class="tab-panel space-y-4">
        <input type="text" placeholder="æ‰‹æœºå·/é‚®ç®±" id="username" required
               class="w-full border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
        <div class="relative">
            <input type="password" placeholder="å¯†ç " id="password" required
                   class="w-full border rounded px-4 py-2 pr-10 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
            <span class="absolute right-3 top-2.5 cursor-pointer" onclick="change_pwd_show()">ğŸ‘ï¸</span>
        </div>

        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded" onclick="handleLogin(event)"
                id="btn-login">
            ç™»å½•
        </button>
    </div>

    <!-- éªŒè¯ç ç™»å½•é¢æ¿ -->
    <div id="code" class="tab-panel hidden space-y-4">
        <input type="text" placeholder="æ‰‹æœºå·"
               class="w-full border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
        <div class="flex gap-2">
            <input type="text" placeholder="éªŒè¯ç "
                   class="flex-1 border rounded px-4 py-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white"/>
            <button class="bg-blue-500 text-white px-4 py-2 rounded">è·å–</button>
        </div>
        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded">ç™»å½•</button>
    </div>

    <!-- æ‰«ç ç™»å½•é¢æ¿ -->
    <div id="qrcode" class="tab-panel hidden text-center">
    </div>

    <div id="messageBox" class="message" style="display: none;"></div>

    <!-- åº•éƒ¨é“¾æ¥ -->
    <div class="flex justify-between mt-6 text-sm text-blue-500 dark:text-blue-400">
        <a href="#">æ³¨å†Œè´¦å·</a>
        <!-- GitHub ç™»å½•æŒ‰é’® -->
        <button id="github-login" class="github-btn">
            <i class="fa-brands fa-github"></i>
        </button>
        <a href="#">å¿˜è®°å¯†ç </a>
    </div>

    <div class="text-center mt-4 text-xs text-gray-500 dark:text-gray-400">
        <a href="#">æœåŠ¡åè®®</a> ï½œ <a href="#">éšç§æ”¿ç­–</a>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.tab-panel');

        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // æ¸…é™¤æ‰€æœ‰æŒ‰é’®çš„çŠ¶æ€
                tabBtns.forEach(b => b.classList.remove('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400'));

                // ä¸ºå½“å‰ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ çŠ¶æ€
                btn.classList.add('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');

                // éšè—æ‰€æœ‰é¢æ¿
                panels.forEach(panel => {
                    panel.classList.add('hidden');
                });

                // æ˜¾ç¤ºå½“å‰ç‚¹å‡»æŒ‰é’®å¯¹åº”çš„é¢æ¿
                const targetPanelId = btn.dataset.tab;
                const targetPanel = document.getElementById(targetPanelId);
                if (targetPanel) {
                    targetPanel.classList.remove('hidden');
                }
            });
        });

        // åˆå§‹åŒ–æ—¶æ˜¾ç¤ºç¬¬ä¸€ä¸ªé¢æ¿
        if (panels.length > 0) {
            panels[0].classList.remove('hidden');
            tabBtns[0].classList.add('font-bold', 'text-blue-600', 'border-b-2', 'border-blue-600', 'dark:text-blue-400', 'dark:border-blue-400');
        }
    });

    // åŠ¨æ€éªŒè¯ç è¾“å…¥å¤„ç†
    const inputs = document.querySelectorAll('.verification-input');
    const messageBox = document.getElementById('messageBox');

    function showMessage(message, type) {
        const msgBox = messageBox;
        let timer;
        msgBox.className = 'message';

        if (type === 'success') {
            msgBox.classList.add('success')
        } else if (type === 'error') {
            msgBox.classList.add("error");
        } else {
            msgBox.classList.add("info");
        }

        msgBox.textContent = message;
        msgBox.style.display = 'block';

        clearTimeout(timer);
        timer = setTimeout(() => {
            msgBox.style.display = 'none';
        }, 3000);
    }

    // ç™»å½•è¡¨å•å¤„ç†
    function handleLogin(event) {
        event.preventDefault();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!username || !password) {
            showMessage('è¯·è¾“å…¥è´¦å·å’Œå¯†ç ', 'error');
            return;
        }

        // const code = Array.from(inputs).map(input => input.value).join('');
        // if (!/^\d{6}$/.test(code)) {
        //     showMessage('è¯·è¾“å…¥6ä½åŠ¨æ€éªŒè¯ç ', 'error');
        //     return;
        // }
        //fixme: è¯·æ±‚è®¤è¯æ¥å£
        const loginData = {
            username: username,
            password: password,
        }
        fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(loginData),
        }).then(response => {
            if (!response.ok) {
                throw new Error(`ç™»å½•å¤±è´¥: ${response.status}`);
            }
            return response.json();
        }).then(data => {
            if (data.code !== 200) {
                throw new Error(`${data.message || 'æœªçŸ¥é”™è¯¯'}`);
            }
            showMessage('ç™»å½•æˆåŠŸï¼Œå³å°†è·³è½¬...', 'success');
            setTimeout(() => {
                window.location.href = '/swagger/index.html'; // æ›¿æ¢ä¸ºå®é™…é¦–é¡µè·¯å¾„
            }, 1000);
        }).catch(error => {
            showMessage('ç™»å½•å¤±è´¥ï¼š' + error.message, 'error');
        });
    }

    function change_pwd_show() {
        document.getElementById('password').type = 'text';
    }

    document.getElementById("pwd").addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
            document.querySelector('#btn-login').click();
        }
    });

    document.getElementById("github-login").addEventListener("click", () => {
        location.href = "/login/github";
    });

</script>
</body>
</html>